<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–µ–ª–æ –≤ –®–ª—è–ø–µ üéì | –®–∫–æ–ª–∞ –ò–ª–ª—é–∑–∏–π</title>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Permanent+Marker&family=Nunito:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <style>
        :root {
            --primary-color: #333333;
            --secondary-color: #FFFFFF;
            --accent-color: #E67E22;
            --bg-light: #FFF0B5;
            --card-shadow: 0 5px 0px 5px rgba(51, 51, 51, 0.7);
            --text-stroke-color: #FFFFFF;
            --border-thick: 3px solid var(--primary-color);
            --gold-color: #FFD700;
        }

        @keyframes slideIn {
            0% { transform: translateX(100%); opacity: 0; }
            100% { transform: translateX(0); opacity: 1; }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); opacity: 0.8; }
            100% { transform: scale(1); }
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--bg-light);
            color: var(--primary-color);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            border: 8px solid var(--primary-color);
        }

        /* --- –ê–£–î–ò–û --- */
        #audio-controls {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 100;
            display: flex;
            gap: 10px;
        }
        .control-button {
            background-color: var(--secondary-color);
            border: var(--border-thick);
            border-radius: 50%;
            width: 45px;
            height: 45px;
            cursor: pointer;
            font-size: 1.4em;
            line-height: 43px;
            text-align: center;
            box-shadow: 2px 2px 0 var(--primary-color);
            transition: transform 0.1s;
        }
        .control-button:active {
            transform: translate(2px, 2px);
            box-shadow: none;
        }

        /* --- –®–ê–ü–ö–ê --- */
        header {
            background-color: var(--primary-color);
            color: var(--bg-light);
            padding: 15px 0;
            text-align: center;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.3);
            font-family: 'Permanent Marker', cursive;
            border-bottom: 3px solid var(--accent-color);
        }
        header h1 {
            font-size: 2.8em;
            text-shadow: 3px 3px 0 var(--accent-color),
                         6px 6px 0 rgba(0, 0, 0, 0.15);
            line-height: 0.9;
            padding: 5px;
        }

        main {
            padding: 25px 0;
            flex-grow: 1;
            max-width: 800px;
            width: 100%;
            margin: 0 auto;
        }

        /* --- –í–´–ë–û–† –ö–£–†–°–ê (–ö–ê–†–£–°–ï–õ–¨) --- */
        #course-selection {
            text-align: center;
            padding: 0 10px;
        }
        #course-selection h2 {
            font-family: 'Bebas Neue', sans-serif;
            color: var(--primary-color);
            font-size: 2.4em;
            margin-bottom: 20px;
            text-transform: uppercase;
            -webkit-text-stroke: 1px var(--text-stroke-color);
            text-stroke: 1px var(--text-stroke-color);
            border-bottom: 2px dashed var(--primary-color);
            padding-bottom: 8px;
            max-width: 760px;
            margin: 0 auto 20px auto;
        }

        .carousel-wrapper {
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            padding: 10px 0;
            margin-bottom: 10px;
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .carousel-wrapper::-webkit-scrollbar { display: none; }

        .course-carousel {
            display: flex;
            gap: 20px;
            padding: 0 10px;
            width: max-content;
        }

        .course-card {
            background-color: var(--secondary-color);
            border-radius: 12px;
            padding: 15px;
            min-width: 200px;
            max-width: 220px;
            height: 300px;
            box-shadow: 5px 5px 0 var(--primary-color);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 3px solid var(--primary-color);
            scroll-snap-align: center;

            display: flex;
            flex-direction: column;
            justify-content: space-between;
            flex-shrink: 0;

            animation: slideIn 0.5s ease-out forwards;
        }
        .course-card:nth-child(2) { animation-delay: 0.1s; }
        .course-card:nth-child(3) { animation-delay: 0.2s; }
        .course-card:nth-child(4) { animation-delay: 0.3s; }
        .course-card:nth-child(5) { animation-delay: 0.4s; }
        .course-card:nth-child(6) { animation-delay: 0.5s; }
        .course-card:nth-child(7) { animation-delay: 0.6s; }

        .course-card:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 8px 8px 0 var(--accent-color);
        }

        .course-card[data-type="big"] {
            border-color: var(--gold-color);
            box-shadow: 5px 5px 0 var(--gold-color);
        }

        .course-card h3 {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.8em;
            color: var(--primary-color);
            text-transform: uppercase;
            margin-bottom: 5px;
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 4px;
        }

        .course-card p {
            color: #555;
            font-style: italic;
            font-size: 0.9em;
            margin-top: 8px;
        }

        .card-image {
            width: 100%;
            height: 120px;
            object-fit: cover;
            border-radius: 6px;
            border: 2px solid var(--primary-color);
            margin-bottom: 10px;
        }

        /* --- –°–ü–ò–°–û–ö –£–†–û–ö–û–í --- */
        #lesson-list-view {
            text-align: center;
            padding: 20px;
            background-color: var(--secondary-color);
            border: var(--border-thick);
            border-radius: 12px;
            box-shadow: 5px 5px 0 var(--primary-color);
            max-width: 600px;
            margin: 20px auto;
        }

        #lesson-list-title {
            font-family: 'Permanent Marker', cursive;
            color: var(--accent-color);
            font-size: 2em;
            margin-bottom: 10px;
        }

        #lesson-list {
            list-style: none;
            padding: 0;
            margin-top: 10px;
        }

        .lesson-item {
            background-color: #fff;
            border-radius: 10px;
            padding: 8px 12px;
            margin-bottom: 6px;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.12);
            cursor: pointer;
            transition: all 0.2s ease;
            border-left: 6px solid var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .lesson-item:hover {
            transform: translateX(4px);
            background-color: #fdf5de;
        }

        .lesson-item.active {
            border-left-color: var(--accent-color);
            background-color: #ffe8c9;
            font-weight: 700;
        }

        .lesson-item-preview {
            width: 90px;
            height: 56px;
            border-radius: 6px;
            object-fit: cover;
            flex-shrink: 0;
            border: 1px solid #ddd;
            background: #f5f5f5;
        }

        .lesson-item span.title {
            flex-grow: 1;
            text-align: left;
            font-size: 0.92em;
        }

        .lesson-item span.duration {
            display: none;
        }

        /* --- –í–ò–î–ï–û-–ü–õ–ï–ï–† 16:9 --- */
        #video-player-view {
            text-align: center;
            padding: 20px;
            background-color: var(--secondary-color);
            border: var(--border-thick);
            border-radius: 12px;
            box-shadow: 5px 5px 0 var(--primary-color);
            max-width: 700px;
            margin: 20px auto;
        }

        #current-lesson-name-label {
            margin-top: 6px;
            font-weight: 700;
            font-size: 0.95em;
        }

        #current-lesson-name {
            color: var(--accent-color);
        }

        .video-player-container-kinescope {
            margin-top: 14px;
            margin-bottom: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.25);
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            padding-top: 56.25%; /* 16:9 */
            width: 100%;
            background: #000;
        }

        @media (min-width: 768px) {
            .video-player-container-kinescope {
                max-width: 640px;
                margin-left: auto;
                margin-right: auto;
            }
        }

        .video-player-container-kinescope iframe {
            position: absolute;
            top: 0; left: 0;
            width: 100%;
            height: 100%;
            border: none;
            z-index: 2;
        }

        .video-thumbnail-large {
            position: absolute;
            top: 0; left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            background-color: #333;
            transition: opacity 0.3s;
            z-index: 1;
        }

        .placeholder-content {
            padding: 6px 0;
            color: var(--primary-color);
        }

        .placeholder-icon {
            font-size: 2.6em;
            color: var(--gold-color);
            margin-bottom: 4px;
            display: block;
            animation: pulse 2s infinite;
        }

        .back-button, #submit-reg-btn, .form-button {
            background-color: var(--primary-color);
            color: var(--bg-light);
            border: 3px solid var(--primary-color);
            padding: 8px 18px;
            border-radius: 6px;
            cursor: pointer;
            margin-bottom: 14px;
            font-weight: 700;
            transition: all 0.1s;
            width: 100%;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.1em;
            box-shadow: 3px 3px 0 var(--accent-color);
            text-transform: uppercase;
        }
        .back-button:hover, #submit-reg-btn:hover, .form-button:hover {
            background-color: #555;
            box-shadow: 3px 3px 0 var(--bg-light);
        }
        .back-button:active, #submit-reg-btn:active, .form-button:active {
            transform: translate(3px, 3px);
            box-shadow: none;
        }

        .hidden { display: none !important; }

        /* --- –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø --- */
        .registration-overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 200;
        }

        .registration-modal {
            background-color: #fff;
            padding: 24px;
            border-radius: 15px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-content-container p {
            margin-bottom: 10px;
            font-size: 0.9em;
            color: #444;
        }

        .policy-text-container {
            font-size: 0.8em;
            max-height: 300px;
            overflow-y: auto;
            padding: 8px;
            border: 1px solid #ddd;
            margin-bottom: 10px;
        }

        .form-group {
            margin-bottom: 10px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 4px;
            font-size: 0.85em;
            font-weight: 700;
        }

        .form-group input {
            width: 100%;
            padding: 6px 8px;
            border-radius: 6px;
            border: 1px solid #ccc;
            font-size: 0.9em;
        }

        .loading-spinner {
            font-size: 0.9em;
            text-align: center;
            padding: 10px 0;
        }

        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 10px;
        }

        @media (min-width: 769px) {
            #swipe-hint { font-size: 0.8em; opacity: 0.8; }
        }
    </style>
</head>
<body>

<div id="audio-controls">
    <audio id="bg-music" src="background_music.mp3" loop preload="auto"></audio>
    <button id="music-toggle" class="control-button" title="–§–æ–Ω–æ–≤–∞—è –º—É–∑—ã–∫–∞">‚ñ∂Ô∏è</button>
    <audio id="click-sound" src="click_sound.mp3" preload="auto"></audio>
</div>

<header>
    <h1>–î–µ–ª–æ –≤ –®–ª—è–ø–µ üéì</h1>
</header>

<main>
    <!-- –í–´–ë–û–† –ù–ê–ë–û–†–ê -->
    <section id="course-selection">
        <h2>–í—ã–±–µ—Ä–∏—Ç–µ —Å–≤–æ–π –æ–±—É—á–∞—é—â–∏–π –Ω–∞–±–æ—Ä —Ç–µ—Ö–Ω–∏–∫</h2>
        <div class="carousel-wrapper" id="course-carousel-wrapper">
            <div class="course-carousel">
                <div class="course-card" data-id="set_75" data-type="big">
                    <img src="images/set1.png" alt="75 –ª—É—á—à–∏—Ö —Ñ–æ–∫—É—Å–æ–≤" class="card-image">
                    <h3>75 –õ–£–ß–®–ò–• –§–û–ö–£–°–û–í</h3>
                    <p>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –∞—Ä—Å–µ–Ω–∞–ª –∏–ª–ª—é–∑–∏–æ–Ω–∏—Å—Ç–∞ –¥–ª—è —É–≤–µ—Ä–µ–Ω–Ω—ã—Ö –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏–π.</p>
                </div>
                <div class="course-card" data-id="set_50" data-type="big">
                    <img src="images/set_new_50.png" alt="50 –ª—É—á—à–∏—Ö —Ñ–æ–∫—É—Å–æ–≤" class="card-image">
                    <h3>50 –õ–£–ß–®–ò–• –§–û–ö–£–°–û–í</h3>
                    <p>–°–∏–ª—å–Ω–∞—è –±–∞–∑–∞ –∏ —Ç–æ–ø–æ–≤—ã–µ —Ç—Ä—é–∫–∏. –í—Å—Ç—É–ø–ª–µ–Ω–∏–µ ‚Äî –Ω–æ–º–µ—Ä 0.</p>
                </div>
                <div class="course-card" data-id="set_35" data-type="big">
                    <img src="images/set_new_35.png" alt="35 –ª—É—á—à–∏—Ö —Ñ–æ–∫—É—Å–æ–≤" class="card-image">
                    <h3>35 –õ–£–ß–®–ò–• –§–û–ö–£–°–û–í</h3>
                    <p>–û—Ç–±–æ—Ä–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö –∏ —è—Ä–∫–∏—Ö –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏–π.</p>
                </div>

                <div class="course-card" data-id="set_green" data-type="small">
                    <img src="images/set_green.png" alt="10 –≤–∑—Ä—ã–≤–Ω—ã—Ö —Ñ–æ–∫—É—Å–æ–≤ (–∑–µ–ª—ë–Ω—ã–π)" class="card-image">
                    <h3>10 –í–ó–†–´–í–ù–´–• (–ó–ï–õ–Å–ù–´–ô)</h3>
                    <p>–ö—É–ø—é—Ä—ã, —Ä–µ–∑–∏–Ω–∫–∏, –ø—Ä–µ–¥–º–µ—Ç—ã ‚Äî –≤—Å–µ–≥–¥–∞ –ø–æ–¥ —Ä—É–∫–æ–π.</p>
                </div>
                <div class="course-card" data-id="set_blue" data-type="small">
                    <img src="images/set_blue.png" alt="10 –≤–∑—Ä—ã–≤–Ω—ã—Ö —Ñ–æ–∫—É—Å–æ–≤ (—Å–∏–Ω–∏–π)" class="card-image">
                    <h3>10 –í–ó–†–´–í–ù–´–• (–°–ò–ù–ò–ô)</h3>
                    <p>–¢—Ä–æ—Å—Ç—å, –ø–µ—á–µ–Ω—å–µ, —Å–µ—Ä–¥–µ—á–∫–∏ –∏ —Ç–µ—Ö–Ω–∏–∫–∞.</p>
                </div>
                <div class="course-card" data-id="set_purple" data-type="small">
                    <img src="images/set_purple.png" alt="10 –≤–∑—Ä—ã–≤–Ω—ã—Ö —Ñ–æ–∫—É—Å–æ–≤ (—Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π)" class="card-image">
                    <h3>10 –í–ó–†–´–í–ù–´–• (–§–ò–û–õ–ï–¢–û–í–´–ô)</h3>
                    <p>–ö–∞—Ä—Ç—ã, –ø–ª–∞—Ç–∫–∏ –∏ –ª–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–µ —Ö–∏—Ç—ã.</p>
                </div>
                <div class="course-card" data-id="set_red" data-type="small">
                    <img src="images/set_red.png" alt="10 –≤–∑—Ä—ã–≤–Ω—ã—Ö —Ñ–æ–∫—É—Å–æ–≤ (–∫—Ä–∞—Å–Ω—ã–π)" class="card-image">
                    <h3>10 –í–ó–†–´–í–ù–´–• (–ö–†–ê–°–ù–´–ô)</h3>
                    <p>–ü–æ—Ä–æ–ª–æ–Ω, —Ü–µ–ø–æ—á–∫–∏ –∏ –∑—Ä–µ–ª–∏—â–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã.</p>
                </div>
            </div>
        </div>
        <p id="swipe-hint" style="text-align: center; color: var(--primary-color); font-weight: 700; margin-top: 4px;">
            –ù–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ ‚Äî —Å–≤–∞–π–ø–Ω–∏—Ç–µ –ø–æ –∫–∞—Ä—Ç–æ—á–∫–∞–º. –ù–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä–µ ‚Äî –ø—Ä–æ–∫—Ä—É—Ç–∏—Ç–µ –∫–æ–ª–µ—Å–æ –º—ã—à–∏ –≤–±–æ–∫.
        </p>
    </section>

    <!-- –°–ü–ò–°–û–ö –£–†–û–ö–û–í -->
    <section id="lesson-list-view" class="hidden">
        <button class="back-button" onclick="showCourseSelection()">
            ‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –≤—ã–±–æ—Ä—É –Ω–∞–±–æ—Ä–æ–≤
        </button>
        <h2 id="lesson-list-title">–ù–∞–±–æ—Ä:</h2>

        <div class="placeholder-content" id="lessons-placeholder">
            <span class="placeholder-icon">üé¨</span>
            <p style="font-size: 1.0em; font-weight: 700; margin-bottom: 4px;">
                –£—Ä–æ–∫–∏ –¥–ª—è –Ω–∞–±–æ—Ä–∞ <span id="placeholder-course-name"></span> –∑–∞–≥—Ä—É–∂–µ–Ω—ã.
            </p>
            <p style="font-size: 0.9em;">
                –í—ã–±–µ—Ä–∏—Ç–µ —É—Ä–æ–∫ –∏–∑ —Å–ø–∏—Å–∫–∞ –Ω–∏–∂–µ, —á—Ç–æ–±—ã –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤–∏–¥–µ–æ.
            </p>
        </div>

        <ul id="lesson-list"></ul>
    </section>

    <!-- –ü–†–û–°–ú–û–¢–† –í–ò–î–ï–û -->
    <section id="video-player-view" class="hidden">
        <button class="back-button" onclick="goBackToLessonList()">
            ‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É —É—Ä–æ–∫–æ–≤
        </button>

        <p id="current-lesson-name-label">
            –°–º–æ—Ç—Ä–∏–º —É—Ä–æ–∫: <span id="current-lesson-name"></span>
        </p>

        <div class="video-player-container-kinescope">
            <iframe
                id="kinescope-player"
                src=""
                allow="autoplay; fullscreen; picture-in-picture; encrypted-media; gyroscope; accelerometer; clipboard-write; screen-wake-lock;"
                frameborder="0"
                allowfullscreen>
            </iframe>
            <img id="video-thumbnail-large" class="video-thumbnail-large" src="" alt="–ü—Ä–µ–≤—å—é —É—Ä–æ–∫–∞">
        </div>

        <div id="no-video-warning" class="placeholder-content hidden">
            <span class="placeholder-icon">üö´</span>
            <p style="font-size: 0.95em; font-weight: 700;">
                –î–ª—è —ç—Ç–æ–≥–æ —É—Ä–æ–∫–∞ –ø–æ–∫–∞ –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω –≤–∏–¥–µ–æ—Ä–æ–ª–∏–∫.
            </p>
            <p style="font-size: 0.85em;">
                –ö–∞–∫ —Ç–æ–ª—å–∫–æ –¥–æ–±–∞–≤–∏–º –∫–æ–¥ Kinescope ‚Äî –∑–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è –≤–∏–¥–µ–æ.
            </p>
        </div>
    </section>
</main>

<!-- –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø -->
<div id="registration-overlay" class="registration-overlay hidden">
    <div class="registration-modal">
        <h2 id="modal-title">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h2>
        <div id="modal-content-container" class="modal-content-container">

            <div id="policy-initial-view">
                <p>–î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –æ–±—É—á–µ–Ω–∏—é –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–≥–ª–∞—Å–∏—Ç—å—Å—è —Å –ü–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏.</p>
                <div class="action-buttons">
                    <button id="read-policy-btn" class="form-button">–ü—Ä–æ—á–∏—Ç–∞—Ç—å –ü–æ–ª–∏—Ç–∏–∫—É</button>
                    <button id="agree-and-continue-btn" class="form-button">–°–æ–≥–ª–∞—Å–∏—Ç—å—Å—è –∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
                </div>
            </div>

            <div id="policy-full-view" class="hidden">
                <p><b>–î–∞—Ç–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –¥–µ–π—Å—Ç–≤—É—é—â–µ–π —Ä–µ–¥–∞–∫—Ü–∏–∏: 1 —Å–µ–Ω—Ç—è–±—Ä—è 2025 –≥–æ–¥–∞</b></p>
                <div class="policy-text-container">
                    <!-- –í—Å—Ç–∞–≤—å —Å—é–¥–∞ –ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –ø–æ–ª–∏—Ç–∏–∫–∏ –∫–∞–∫ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Å–∞–π—Ç–µ -->
                    <p>1. –û–±—â–∏–µ –ø–æ–ª–æ–∂–µ–Ω–∏—è, —Å—Ç–æ—Ä–æ–Ω—ã, —Ü–µ–ª—å –¥–æ–∫—É–º–µ–Ω—Ç–∞...</p>
                </div>
                <button id="agree-final-btn" class="form-button">–°–æ–≥–ª–∞—Å–∏—Ç—å—Å—è —Å –ü–æ–ª–∏—Ç–∏–∫–æ–π</button>
            </div>

            <div id="registration-form-view" class="hidden">
                <form id="registration-form">
                    <div class="form-group">
                        <label for="reg-name">–§–∞–º–∏–ª–∏—è –∏ –ò–º—è:</label>
                        <input type="text" id="reg-name" name="name" required placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω">
                    </div>
                    <div class="form-group">
                        <label for="reg-age">–í–æ–∑—Ä–∞—Å—Ç:</label>
                        <input type="number" id="reg-age" name="age" min="1" max="120" required>
                    </div>
                    <div class="form-group">
                        <label for="reg-phone">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞:</label>
                        <input type="tel" id="reg-phone" name="phone" pattern="\+?[0-9]{10,15}" required placeholder="+79123456789">
                    </div>
                    <div class="form-group hidden">
                        <label for="reg-tg-id">Telegram ID (–°–∫—Ä—ã—Ç–æ):</label>
                        <input type="text" id="reg-tg-id" name="tg_id">
                    </div>
                    <button type="submit" id="submit-reg-btn" class="form-button">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –∏ –Ω–∞—á–∞—Ç—å</button>
                </form>
            </div>

            <div id="success-view" class="hidden" style="text-align: center;">
                <h3 style="color: green;">üéâ –£—Å–ø–µ—à–Ω–æ!</h3>
                <p>–í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã. –í—ã –º–æ–∂–µ—Ç–µ –ø—Ä–∏—Å—Ç—É–ø–∏—Ç—å –∫ –æ–±—É—á–µ–Ω–∏—é.</p>
                <button onclick="hideRegistrationModal()" class="back-button">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
            </div>

            <div id="loading-spinner" class="loading-spinner hidden">
                –ó–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö... üöÄ –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ...
            </div>

        </div>
    </div>
</div>

<script>
    // === 0. –ö–û–ù–°–¢–ê–ù–¢–´ ===
    const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycby2R4j1aBQ2zmybXyqjVhgFntoduCYYX6AuZ8kMmRUWdF8ZQCNTTpPij0kmxaSxAZmjvg/exec';
    const IMAGE_BASE_URL = 'images/';
    const USER_STORAGE_KEY = 'magic_course_user_registered_hat';
    const TG_ID_STORAGE_KEY = 'magic_course_tg_id_hat';

    function createLessonsFromNames(names, folder) {
        return names.map((name, index) => ({
            name,
            duration: '',
            videoId: '',
            imageUrl: `${IMAGE_BASE_URL}${folder}/${String(index + 1).padStart(2, '0')}.webp`
        }));
    }

    // === 1. –ù–ê–ë–û–† "75 –ª—É—á—à–∏—Ö —Ñ–æ–∫—É—Å–æ–≤" ===
    const set75Lessons = [
      { name: '–§–æ–∫—É—Å —Å –º–æ–Ω–µ—Ç–∫–æ–π –∏ —Å—Ç–∞–∫–∞–Ω–æ–º ‚Ññ1', videoId: '08Kx6GWfuLJ15VVLB9wZRg', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/01.webp` },
      { name: '–§–æ–∫—É—Å —Å –º–æ–Ω–µ—Ç–∫–æ–π –∏ —Å—Ç–∞–∫–∞–Ω–æ–º ‚Ññ2', videoId: '4FHn2u9avtFz5y5edoaKZn', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/02.webp` },
      { name: '–§–æ–∫—É—Å —Å–æ —Å—Ç–∞–∫–∞–Ω–æ–º', videoId: 'iwYebxbfYgsWiSavnG6f73', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/03.webp` },
      { name: '–§–æ–∫—É—Å —Å –º–æ–Ω–µ—Ç–∫–æ–π –∏ —Å—Ç–∞–∫–∞–Ω–æ–º ‚Ññ3', videoId: 'k1A2Gu5q9jt1Ergg13B2xN', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/04.webp` },
      { name: '–§–æ–∫—É—Å —Å –ø–ª–∞—Ç–∫–æ–º –∏ –ø–ª–∞—Å—Ç–∏–Ω–∫–æ–π', videoId: 'vB8PZ3bum4EmiCjz1s7p2e', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/05.webp` },
      { name: '–§–æ–∫—É—Å —Å –ø–ª–∞—Ç–∫–æ–º –∏ —Ä—É—á–∫–æ–π', videoId: 'nMsgE7FV9egrpvLV842tof', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/06.webp` },
      { name: '–§–æ–∫—É—Å —Å –º–∞–≥–Ω–∏—Ç–∞–º–∏ –∏ —Å—Ç–∞–∫–∞–Ω–æ–º', videoId: '6r3pPfgPBdLiAU1aH1dSE1', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/07.webp` },
      { name: '–§–æ–∫—É—Å —Å —à–∞—Ä–∏–∫–æ–º –∏ —Å—Ç–∞–∫–∞–Ω–æ–º', videoId: 'tet1Tag2mdzR5PTSaCpdJQ', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/08.webp` },
      { name: '–§–æ–∫—É—Å —Å —Å–∏–ª–∏–∫–æ–Ω–æ–≤–æ–π –º–∞—Ç–µ—Ä–∏–µ–π –∏ –º–æ–Ω–µ—Ç–æ–π', videoId: '3N8d6wnNCJXAsmfor37Z6C', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/09.webp` },
      { name: '–§–æ–∫—É—Å —Å –±—É–º–∞–∂–Ω—ã–º —Å—Ç–∞–∫–∞–Ω—á–∏–∫–æ–º ‚Ññ1', videoId: 'eDXSZnJPXwxNWPkbqA1GFo', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/10.webp` },
      { name: '–§–æ–∫—É—Å —Å –±—É–º–∞–∂–Ω—ã–º —Å—Ç–∞–∫–∞–Ω—á–∏–∫–æ–º ‚Ññ2', videoId: 'rcmNCKZFbdqFFTNroutiYN', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/11.webp` },
      { name: '–§–æ–∫—É—Å —Å–æ —Å—Ç–∞–∫–∞–Ω–æ–º —Å –∂–∏–¥–∫–æ—Å—Ç—å—é', videoId: 'a381iv6Ly1Q8ZdCrWG1j2Q', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/12.webp` },
      { name: '–§–æ–∫—É—Å —Å –≤–æ–∑–¥—É—à–Ω—ã–º —à–∞—Ä–∏–∫–æ–º', videoId: 'suppep3Dju2U1ZAeti1Ueh', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/13.webp` },
      { name: '–§–æ–∫—É—Å —Å –∫–æ—Ä–æ–±–æ—á–∫–æ–π —Å —à–∞—Ä–∏–∫–æ–º', videoId: '5NX3JZh6W3trGYAYCcrrwq', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/14.webp` },
      { name: '–§–æ–∫—É—Å —Å –±—É—Ç—ã–ª–∫–æ–π –∏ –æ—Å—å–º–∏–Ω–æ–≥–æ–º', videoId: 'osEDVw8PfuNgWAAYFzdDci', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/15.webp` },
      { name: '–§–æ–∫—É—Å —Å —Ç—Ä—É–±–æ—á–∫–∞–º–∏ ‚Ññ1', videoId: '2K9LBkR7qGDDnbqf55VQ3P', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/16.webp` },
      { name: '–§–æ–∫—É—Å —Å —Ç—Ä—É–±–æ—á–∫–∞–º–∏ ‚Ññ2', videoId: '4qK7Q3Nar6yrCJ4iLhYutr', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/17.webp` },
      { name: '–§–æ–∫—É—Å —Å —Ç—Ä—É–±–æ—á–∫–∞–º–∏ ‚Ññ3', videoId: 'sCxSEjrysf1NkoYJXBNqbr', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/18.webp` },
      { name: '–§–æ–∫—É—Å —Å —Ç—Ä—É–±–æ—á–∫–∞–º–∏ ‚Ññ4', videoId: 'quCvhgExNKs6ckrRRsp5Xe', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/19.webp` },
      { name: '–§–æ–∫—É—Å —Å —Ç—Ä—É–±–æ—á–∫–∞–º–∏ ‚Ññ5', videoId: '3UG5pnU1eeK6qMxmkS4sDk', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/20.webp` },
      { name: '–§–æ–∫—É—Å —Å —Ç—Ä—É–±–æ—á–∫–∞–º–∏ ‚Ññ6', videoId: 'xf5gR8ziY4UUxTZrVcPYUW', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/21.webp` },
      { name: '–§–æ–∫—É—Å —Å —Ç—Ä—É–±–æ—á–∫–∞–º–∏ ‚Ññ7', videoId: '7D2Pyu2hVPkaQcvfdSDnSn', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/22.webp` },
      { name: '–§–æ–∫—É—Å —Å —Ç—Ä—É–±–æ—á–∫–∞–º–∏ ‚Ññ8', videoId: '4nAZBgzGS9fs2uav9ko136', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/23.webp` },
      { name: '–§–æ–∫—É—Å —Å —Ä—É—á–∫–æ–π ‚Ññ1', videoId: '2Ge2y8YGMW6W5hjjv1toy9', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/24.webp` },
      { name: '–§–æ–∫—É—Å —Å —Ä—É—á–∫–æ–π –∏ –∫—É–ø—é—Ä–æ–π ‚Ññ1', videoId: 'oq3Eq1vonpJQ9gt1C7qaS6', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/25.webp` },
      { name: '–§–æ–∫—É—Å —Å –≤–æ–ª—à–µ–±–Ω–æ–π –ø–∞–ª–æ—á–∫–æ–π ‚Ññ1', videoId: 'cUK7UtoqNS6aHZb7MUhKJf', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/26.webp` },
      { name: '–§–æ–∫—É—Å —Å —Ä—É—á–∫–æ–π –∏ –∫—É–ø—é—Ä–æ–π ‚Ññ2', videoId: '4crYByNehEmS3Pw5xydY8U', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/27.webp` },
      { name: '–§–æ–∫—É—Å —Å –≤–æ–ª—à–µ–±–Ω–æ–π —Ç—Ä–æ—Å—Ç—å—é', videoId: '0BhyKpcf17f4AXPLSkdGQU', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/28.webp` },
      { name: '–§–æ–∫—É—Å —Å –ø–µ—á–µ–Ω—å–µ–º', videoId: 'hbcu7w4WB2mTi1YTrTwW1A', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/29.webp` },
      { name: '–§–æ–∫—É—Å —Å —Ä–∞—Å–∫—Ä–∞—Å–∫–æ–π', videoId: 'bxQHGnDfqkb89pbu9CCo3H', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/30.webp` },
      { name: '–§–æ–∫—É—Å —Å –±—É–ª–∞–≤–∫–æ–π —Å–æ —Å–ø–∏—á–∫–æ–π', videoId: '5ZxzLHp5E5psTbddjLaTNM', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/31.webp` },
      { name: '–§–æ–∫—É—Å —Å –º–æ–Ω–µ—Ç–∫–æ–π ‚Ññ1', videoId: '0FKMpLiKdNu37ivBzHf8LS', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/32.webp` },
      { name: '–§–æ–∫—É—Å —Å –º–æ–Ω–µ—Ç–∫–æ–π –∏ –ª–µ–¥–µ–Ω—Ü–æ–º', videoId: 'oBLcgZeiP2txJM9vmENCkG', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/33.webp` },
      { name: '–§–æ–∫—É—Å —Å –∫—Ä—É–≥–ª–æ–π —à–∫–∞—Ç—É–ª–∫–æ–π', videoId: 'xwjShnyz358X56Gmw1b1J2', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/34.webp` },
      { name: '–§–æ–∫—É—Å —Å –≤–æ–ª—à–µ–±–Ω–æ–π –ø–∞–ª–æ—á–∫–æ–π ‚Ññ2', videoId: 'egJeHpt8N8eBgxUH8PpMtx', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/35.webp` },
      { name: '–§–æ–∫—É—Å —Å –∫—É–≤—à–∏–Ω–æ–º', videoId: 'rCnFZyShmj1aw38pQni85Y', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/36.webp` },
      { name: '–§–æ–∫—É—Å —Å –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–æ–π —à–∫–∞—Ç—É–ª–∫–æ–π', videoId: 'dSiZqEQkN3WFokSwQx2hZ6', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/37.webp` },
      { name: '–§–æ–∫—É—Å —Å –ø—É—à–∏—Å—Ç–∏–∫–æ–º –ë–∞–π–ª–∞', videoId: 'tQowRoUYHFa7PVRqWaXPnL', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/38.webp` },
      { name: '–§–æ–∫—É—Å —Å –∫–æ–ª–æ–¥–æ–π –≤ —Ñ—É—Ç–ª—è—Ä–µ', videoId: 'caWeZpxqUvnseP15fVYcRh', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/39.webp` },
      { name: '–§–æ–∫—É—Å —Å —Ä—É—á–∫–æ–π ‚Ññ3', videoId: 'dCY6qS39XBACXPNxh64Xhx', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/40.webp` },
      { name: '–§–æ–∫—É—Å —Å –∫—Ä—ã—à–∫–∞–º–∏', videoId: 'gMCYd4fnqmWLeXYSVRNtbo', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/41.webp` },
      { name: '–§–æ–∫—É—Å —Å –≤–µ—Ä—ë–≤–∫–æ–π', videoId: 'dqoeyZ1K93Zc9tFzSBjpND', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/42.webp` },
      { name: '–§–æ–∫—É—Å —Å –º–æ–Ω–µ—Ç–∫–æ–π ‚Ññ2', videoId: '0grSSEB315A3f2NcQKyXMa', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/43.webp` },
      { name: '–§–æ–∫—É—Å —Å –º–æ–Ω–µ—Ç–∫–æ–π ‚Ññ3', videoId: '0yXkYxUkvEdzpsz2HKVmex', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/44.webp` },
      { name: '–§–æ–∫—É—Å —Å –º–æ–Ω–µ—Ç–∫–æ–π –∏ –±—É—Ç—ã–ª–∫–æ–π', videoId: '5ruZSqV2cyPrNS1JDDhfmb', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/45.webp` },
      { name: '–§–æ–∫—É—Å —Å –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏ —Å –∂–∏–≤–æ—Ç–Ω—ã–º–∏', videoId: 'ifq98xGLDDuLUTg51iSWWK', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/46.webp` },
      { name: '–í–Ω–∏–º–∞–Ω–∏–µ: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –Ω–∞ –¥–∏—Å–∫–µ (–£–≥–∞–¥–∞—é —Ç–≤–æ—é –∫–∞—Ä—Ç—É)', videoId: '', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/47.webp` },
      { name: '–§–æ–∫—É—Å —Å –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏ —Å –¥–µ—Å–µ—Ä—Ç–∞–º–∏', videoId: 'jnYhSV2iDrqRZ58rX1Q5to', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/48.webp` },
      { name: '–§–æ–∫—É—Å —Å –∫–∞—Ä—Ç–æ—á–∫–æ–π ‚Äú–î–∞–π –ø—è—Ç—å‚Äù', videoId: 'jNQZYyMxM6Psv3aEQph7d4', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/49.webp` },
      { name: '–§–æ–∫—É—Å —Å –±–∞–Ω–æ—á–∫–æ–π —Å –∫—É–±–∏–∫–æ–º', videoId: '2H1jE5fv7erQmXfrGzmxq2', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/50.webp` },
      { name: '–§–æ–∫—É—Å —Å –∫—É–±–∏–∫–∞–º–∏', videoId: 'oTZDwfWj7oTBu4yD2JXLZs', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/51.webp` },
      { name: '–§–æ–∫—É—Å —Å –ª–∏—Å—Ç–æ–º –±—É–º–∞–≥–∏', videoId: 'uXQE4Y3SU3Lb7YMnKT3jmT', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/52.webp` },
      { name: '–í–Ω–∏–º–∞–Ω–∏–µ: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –Ω–∞ –¥–∏—Å–∫–µ (–£–≥–∞–¥–∞—é –∑–∞–¥—É–º–∞–Ω–Ω–æ–µ –∑—Ä–∏—Ç–µ–ª–µ–º, —Å —Å–æ–æ–±—â–Ω–∏–∫–æ–º)', videoId: '', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/53.webp` },
      { name: '–§–æ–∫—É—Å —Å –∫–æ–ª–æ–¥–æ–π –∫–∞—Ä—Ç ‚Ññ1', videoId: '22QyaLJACfbBWveFoWPB4W', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/54.webp` },
      { name: '–§–æ–∫—É—Å —Å –∫–æ–ª–æ–¥–æ–π –∫–∞—Ä—Ç ‚Ññ2', videoId: 'w84xxUQNgY4ahTDtgvR7wt', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/55.webp` },
      { name: '–§–æ–∫—É—Å —Å –∫–æ–ª–æ–¥–æ–π –∫–∞—Ä—Ç ‚Ññ3', videoId: 'iz78bQfjMiJTzdtAqS5fGt', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/56.webp` },
      { name: '–§–æ–∫—É—Å —Å –∫–æ–ª–æ–¥–æ–π –∫–∞—Ä—Ç ‚Ññ4', videoId: '84CSAV9U3anYLEjsJUDdpc', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/57.webp` },
      { name: '–§–æ–∫—É—Å —Å –∫–æ–ª–æ–¥–æ–π –∫–∞—Ä—Ç ‚Ññ5', videoId: 'ekMb5PEruDL7E952AEpZji', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/58.webp` },
      { name: '–§–æ–∫—É—Å —Å –∫–æ–ª–æ–¥–æ–π –∫–∞—Ä—Ç —Å —á–µ–ª–æ–≤–µ—á–∫–æ–º', videoId: 'a4JeWQCkqSLTZZMAW818YW', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/59.webp` },
      { name: '–§–æ–∫—É—Å —Å –∫–∞—Ä—Ç–∞–º–∏ ‚Ññ1', videoId: 'g1PFvTYHreDSyj4wbrzMDs', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/60.webp` },
      { name: '–§–æ–∫—É—Å —Å –∫–∞—Ä—Ç–∞–º–∏ ‚Ññ2', videoId: 'qYGrHajXj481fCG1mZfF3d', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/61.webp` },
      { name: '–§–æ–∫—É—Å —Å –∫–∞—Ä—Ç–∞–º–∏ ‚Ññ3', videoId: 'a3csho4mnthBXHoaQJq5oB', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/62.webp` },
      { name: '–§–æ–∫—É—Å —Å –∫–∞—Ä—Ç–∞–º–∏ ‚Ññ4', videoId: 'gDa3MWw7tjjswRHiRnN7wN', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/63.webp` },
      { name: '–§–æ–∫—É—Å —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ä—É–∫', videoId: 'hgcwhFh2BpmXqfKKJZaTNv', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/64.webp` },
      { name: '–§–æ–∫—É—Å —Å –∫–∞—Ä—Ç–∞–º–∏ ‚Ññ5', videoId: '7Lgt1C8Bwbg4nFbD9rHfr3', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/65.webp` },
      { name: '–§–æ–∫—É—Å —Å –∫–æ—à–µ–ª—å–∫–æ–º —Å –∫–∞—Ä—Ç–∞–º–∏', videoId: 'ahtEMk8QwNqhrWco8uoTYz', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/66.webp` },
      { name: '–§–æ–∫—É—Å —Å —Ä–µ–∑–∏–Ω–∫–∞–º–∏ ‚Ññ1', videoId: '7asYipHJNxxQKntnpVWqoa', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/67.webp` },
      { name: '–§–æ–∫—É—Å —Å –º–æ–Ω–µ—Ç–∫–æ–π –∏ –∫—É–ø—é—Ä–æ–π', videoId: 'eB9NGLCP5dAXARRikmcdEm', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/68.webp` },
      { name: '–§–æ–∫—É—Å —Å —Ä–µ–∑–∏–Ω–∫–æ–π', videoId: 'fLq4jibjivVwxSdXWLAvGp', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/69.webp` },
      { name: '–§–æ–∫—É—Å —Å —Ä–µ–∑–∏–Ω–∫–∞–º–∏ ‚Ññ2', videoId: 'jD9gcu7q8ueA4WYAmG9ru6', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/70.webp` },
      { name: '–§–æ–∫—É—Å —Å —Ä–µ–∑–∏–Ω–∫–æ–π –∏ –∫—É–ø—é—Ä–æ–π', videoId: 'iBDgbkmsWR5auygAR8Q7jk', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/71.webp` },
      { name: '–§–æ–∫—É—Å —Å –∫—É–ø—é—Ä–æ–π –∏ –±—É–º–∞–∂–∫–æ–π', videoId: '4xKuVdUEDwtxQZju6VzAKv', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/72.webp` },
      { name: '–§–æ–∫—É—Å —Å –∫—É–ø—é—Ä–∞–º–∏', videoId: 'j7b24mjPkfeYggjfxJy27D', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/73.webp` },
      { name: '–§–æ–∫—É—Å —Å –∫–∞—Ä—Ç–æ—á–∫–æ–π –∫–ª–æ—É–Ω–∞', videoId: '', duration: '', imageUrl: `${IMAGE_BASE_URL}set75/74.webp` }
    ];

    // === 2. –ù–ê–ë–û–† "50 –ª—É—á—à–∏—Ö —Ñ–æ–∫—É—Å–æ–≤" (0 ‚Äî –≤—Å—Ç—É–ø–ª–µ–Ω–∏–µ) ===
    const set50Names = [
        "–û –Ω–∞–±–æ—Ä–µ",
        "–§–æ–∫—É—Å —Å –≤–æ–ª—à–µ–±–Ω–æ–π –ø–∞–ª–æ—á–∫–æ–π –∏ –≥–æ—Ä—à–æ—á–∫–æ–º",
        "–§–æ–∫—É—Å —Å –≤–æ–ª—à–µ–±–Ω–æ–π –ø–∞–ª–æ—á–∫–æ–π –∏ –∫—É–±–∏–∫–æ–º",
        "–§–æ–∫—É—Å —Å –≤–æ–ª—à–µ–±–Ω–æ–π –ø–∞–ª–æ—á–∫–æ–π ‚Ññ1",
        "–§–æ–∫—É—Å —Å —á–∏—Å–ª–æ–≤—ã–º–∏ –∫–∞—Ä—Ç–∞–º–∏",
        "–§–æ–∫—É—Å —Å —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–µ–º –≤–µ—Ä—ë–≤–∫–∏",
        "–§–æ–∫—É—Å —Å –∏–≥—Ä–∞–ª—å–Ω—ã–º –∫—É–±–∏–∫–æ–º",
        "–§–æ–∫—É—Å —Å –±–∞–Ω–æ—á–∫–æ–π —Å –∫—É–±–∏–∫–∞–º–∏",
        "–§–æ–∫—É—Å —Å –ø–ª–∞—Ç–∫–æ–º –∏ –Ω–∞–ø–∞–ª—å—á–Ω–∏–∫–æ–º",
        "–§–æ–∫—É—Å —Å –∫–∞—Ä—Ç–æ–π —Å –ª–µ—Å–∫–æ–π –∏ —Å–ø–∏—á–∫–æ–π",
        "–§–æ–∫—É—Å —Å —Ä–∞–∑–Ω–æ—Ü–≤–µ—Ç–Ω—ã–º–∏ –ø–ª–∞—Ç–∫–∞–º–∏",
        "–§–æ–∫—É—Å —Å –∫–æ–ª—å—Ü–æ–º –∏ —Ü–µ–ø–æ—á–∫–æ–π",
        "–§–æ–∫—É—Å —Å –∫–æ–ª—å—Ü–æ–º –∏ —Ä–µ–∑–∏–Ω–∫–æ–π",
        "–§–æ–∫—É—Å —Å —Ä–µ–∑–∏–Ω–∫–æ–π ‚Ññ1",
        "–§–æ–∫—É—Å —Å —Å–µ—Ä–¥–µ—á–∫–∞–º–∏ ‚Ññ1",
        "–§–æ–∫—É—Å —Å —Å–µ—Ä–¥–µ—á–∫–∞–º–∏ ‚Ññ2",
        "–§–æ–∫—É—Å —Å –±–∞—à–µ–Ω–∫–æ–π —Å —à–∞—Ä–∏–∫–æ–º",
        "–§–æ–∫—É—Å —Å —à–∞—Ä–∏–∫–æ–º",
        "–§–æ–∫—É—Å —Å–æ —Å—Ç–∞–∫–∞–Ω–∞–º–∏ –∏ —à–∞—Ä–∏–∫–∞–º–∏",
        "–§–æ–∫—É—Å —Å–æ —Å—Ç–∞–∫–∞–Ω–æ–º ‚Ññ1",
        "–§–æ–∫—É—Å —Å –¥–≤–æ–π–Ω—ã–º–∏ –∫–∞—Ä—Ç–∞–º–∏",
        "–§–æ–∫—É—Å —Å —Ä–µ–∑–∏–Ω–∫–æ–π ‚Ññ2",
        "–§–æ–∫—É—Å —Å –≤–µ—Ä—ë–≤–∫–æ–π ‚Ññ1",
        "–§–æ–∫—É—Å —Å –ª–∏—Å—Ç–æ–º –±—É–º–∞–≥–∏",
        "–§–æ–∫—É—Å —Å –º–æ–Ω–µ—Ç–∫–æ–π",
        "–§–æ–∫—É—Å —Å –Ω–∞–ø–∞–ª—å—á–Ω–∏–∫–æ–º",
        "–§–æ–∫—É—Å —Å –∫–∞—Ä—Ç–æ–π —Å–æ —Å—Ç–≤–æ—Ä–∫–æ–π",
        "–§–æ–∫—É—Å —Å –≤–µ—Ä—ë–≤–∫–æ–π –∏ —Å–ø–∏—á–µ—á–Ω—ã–º –∫–æ—Ä–æ–±–∫–æ–º",
        "–§–æ–∫—É—Å —Å–æ —Å–ø–∏—á–µ—á–Ω—ã–º –∫–æ—Ä–æ–±–∫–æ–º ‚Ññ1",
        "–§–æ–∫—É—Å —Å —Å–µ—Ä–¥–µ—á–∫–∞–º–∏ ‚Ññ3",
        "–§–æ–∫—É—Å —Å–æ —Å–ø–∏—á–µ—á–Ω—ã–º –∫–æ—Ä–æ–±–∫–æ–º ‚Ññ2",
        "–§–æ–∫—É—Å —Å —Å–∞–ª—Ñ–µ—Ç–∫–æ–π",
        "–§–æ–∫—É—Å —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ø–∞–ª—å—Ü–µ–≤",
        "–§–æ–∫—É—Å —Å–æ —Å–ø–∏—á–∫–∞–º–∏ ‚Ññ1",
        "–§–æ–∫—É—Å —Å–æ —Å–ø–∏—á–∫–∞–º–∏ ‚Ññ2",
        "–§–æ–∫—É—Å —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ä—É–∫",
        "–§–æ–∫—É—Å —Å —Ä–µ–∑–∏–Ω–∫–∞–º–∏ ‚Ññ1",
        "–§–æ–∫—É—Å —Å —Ä–µ–∑–∏–Ω–∫–æ–π ‚Ññ3",
        "–§–æ–∫—É—Å —Å–æ —Å–ø–∏—á–µ—á–Ω—ã–º –∫–æ—Ä–æ–±–∫–æ–º –∏ –≤–æ–∑–¥—É—à–Ω—ã–º —à–∞—Ä–∏–∫–æ–º",
        "–§–æ–∫—É—Å —Å–æ —Å—Ç–∞–∫–∞–Ω–æ–º —Å –∂–∏–¥–∫–æ—Å—Ç—å—é",
        "–§–æ–∫—É—Å —Å —Ä–µ–∑–∏–Ω–∫–∞–º–∏ ‚Ññ2",
        "–§–æ–∫—É—Å —Å –≤–µ—Ä—ë–≤–∫–æ–π ‚Ññ2",
        "–§–æ–∫—É—Å —Å –≤–µ—Ä—ë–≤–∫–æ–π ‚Ññ3",
        "–§–æ–∫—É—Å —Å –∫–∞—Ä—Ç–æ–π –∏ –∫—É–ø—é—Ä–æ–π",
        "–§–æ–∫—É—Å —Å –∫–æ–ª—å—Ü–æ–º",
        "–§–æ–∫—É—Å —Å–æ —Å–ª–æ–∂–µ–Ω–Ω–æ–π –∫—É–ø—é—Ä–æ–π",
        "–§–æ–∫—É—Å —Å –≤–æ–ø—Ä–æ—Å–∞–º–∏ ‚Ññ1",
        "–§–æ–∫—É—Å —Å–æ —Å—Ç–∞–∫–∞–Ω–æ–º ‚Ññ2",
        "–§–æ–∫—É—Å —Å –∫—É–ø—é—Ä–æ–π —Å–æ —Å–∫—Ä–µ–ø–∫–∞–º–∏",
        "–§–æ–∫—É—Å —Å –≤–æ–ø—Ä–æ—Å–∞–º–∏ ‚Ññ2",
        "–§–æ–∫—É—Å —Å –≤–æ–ª—à–µ–±–Ω–æ–π –ø–∞–ª–æ—á–∫–æ–π ‚Ññ2"
    ];

    const set50Ids = [
        "3ToVuRrRbETNc9CS8dK6PN",
        "bASv2KDXm3exPSJhXijGv7",
        "k7LVHDdYbLP6nJHeE78jZZ",
        "gBuMcScL9G2Tctsq4nV53o",
        "kQRzENqLzFHbN9zoSkELur",
        "wzotde87eg2SCza8ifUMTV",
        "8PiozEkZ2ShCxqhyMkGTC6",
        "sCuBGxqbufwwyfyTR875v1",
        "n16yQfgApriXzJve1fJTGh",
        "6AMFukucjvC3pGK8iyH4Et",
        "tyW2R4vq5BzFFMy95zdDM3",
        "5NdmGkdYeLpa5FT5X64bn8",
        "nJNkwpMN2QY6twvXmLwcBD",
        "2Fu99zt3jN8X2opw8ZXuAr",
        "8SFRsCyg5EpppTctLvPHR6",
        "vNP61NmohuHVddHan6cdUj",
        "3KN6yrnnmiotcqPKjy6c7C",
        "vehKRwE4NzTi4yaMJkxcSv",
        "qTTKJXx4oFuhbKuZAeKnDq",
        "jaj5LtYzdQZa3Q9XBg6ydm",
        "o4KKfSfM3ojWhJbGqZGHQH",
        "jLMFoYJxp9oskaD77C8jWP",
        "kAPviofbQ9ZZ54HdJF9Wtw",
        "7bjn4Vj2Rc4qbHCF86ut78",
        "3j2wei9949NT9fWMUqrNKh",
        "2xBJbT1mLo9ZdYx1THsPpb",
        "7PnVtftEgskF1LXb7b1YPp",
        "8JeakD88Y9SCkgWRkRrryW",
        "g4YY8iCjqRUwp9RYzBnJCj",
        "eYiXB7XWaSahT47YvaBAJS",
        "c69d54HhkmgjSrgyXtpCTE",
        "hpQTFLA3tgvfiXsN9K7AYK",
        "ciAQ7xRb8hS9DXHKvgFCKc",
        "m8YVCXwW2ei7fUxZ5cZ4c2",
        "rQecge353H6iCLYhtfdP1b",
        "a4RGrJXp1bdPZhqBwMUErz",
        "qRDCo5oqBcAbE33GegxQR7",
        "74Kn1XNY1tK3Qc3gotYVbx",
        "fVrETbquXomMmrf6DGz9xc",
        "u5TLFJpLzzGtxfBbZBo9ey",
        "aBWpSUmQvP9gqwf1UorosR",
        "wtMN3Q3zu5AFg5f93aPtyk",
        "wzNwHj9nqZ3XYwh4PgNk3y",
        "wZxGXN8MVxRkM3qtfMmdw5",
        "pQqNbBfFoxjRptWxZWTuKn",
        "iNE6ZoZkS9X8PQajd9cRdb",
        "hJvSAUQLGSLS5QiAwLr4P8",
        "pb3qbXi6CxM4CYCLEA5Qxn",
        "kkem4qCQPo8tfSkE2BSD3u",
        "6dPvUz1Br9NzPJB8rSfzfn",
        "fdnxr9H6yFkHK8SmuKs35X"
    ];

    const set50Lessons = set50Names.map((name, index) => ({
        name,
        duration: '',
        videoId: set50Ids[index] || '',
        // 0 -> 00.webp, 1 -> 01.webp –∏ —Ç.–¥.
        imageUrl: `${IMAGE_BASE_URL}set50/${String(index).padStart(2, '0')}.webp`
    }));

    // –û—Å—Ç–∞–ª—å–Ω—ã–µ –Ω–∞–±–æ—Ä—ã –ø–æ–∫–∞ –ø—É—Å—Ç—ã–µ ‚Äî –¥–æ–±–∞–≤–∏—à—å –ø–æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
    const set35Lessons = createLessonsFromNames([], 'set35');
    const greenLessons = createLessonsFromNames([], 'set_green');
    const blueLessons = createLessonsFromNames([], 'set_blue');
    const purpleLessons = createLessonsFromNames([], 'set_purple');
    const redLessons = createLessonsFromNames([], 'set_red');

    const courses = {
        set_75:     { title: '75 –ª—É—á—à–∏—Ö —Ñ–æ–∫—É—Å–æ–≤',             lessons: set75Lessons, indexOffset: 1 },
        set_50:     { title: '50 –ª—É—á—à–∏—Ö —Ñ–æ–∫—É—Å–æ–≤',             lessons: set50Lessons, indexOffset: 0 }, // —Ç—É—Ç —Å –Ω—É–ª—è
        set_35:     { title: '35 –ª—É—á—à–∏—Ö —Ñ–æ–∫—É—Å–æ–≤',             lessons: set35Lessons, indexOffset: 1 },
        set_green:  { title: '10 –≤–∑—Ä—ã–≤–Ω—ã—Ö —Ñ–æ–∫—É—Å–æ–≤ (–∑–µ–ª—ë–Ω—ã–π)', lessons: greenLessons, indexOffset: 1 },
        set_blue:   { title: '10 –≤–∑—Ä—ã–≤–Ω—ã—Ö —Ñ–æ–∫—É—Å–æ–≤ (—Å–∏–Ω–∏–π)',   lessons: blueLessons,  indexOffset: 1 },
        set_purple: { title: '10 –≤–∑—Ä—ã–≤–Ω—ã—Ö —Ñ–æ–∫—É—Å–æ–≤ (—Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π)', lessons: purpleLessons, indexOffset: 1 },
        set_red:    { title: '10 –≤–∑—Ä—ã–≤–Ω—ã—Ö —Ñ–æ–∫—É—Å–æ–≤ (–∫—Ä–∞—Å–Ω—ã–π)', lessons: redLessons,   indexOffset: 1 }
    };

    // === 3. –ì–õ–û–ë–ê–õ ===
    let courseSelectionPage, lessonListView, videoPlayerView, lessonList;
    let currentCourseId = null;
    let bgMusic, clickSound, isMusicPlaying = false, isSoundEnabled = true;
    let kinescopePlayer, videoThumbnailLarge, noVideoWarning;
    let registrationOverlay, policyInitialView, policyFullView, registrationFormView, successView;
    let registrationForm, loadingSpinner;

    function initializeDOMElements() {
        courseSelectionPage = document.getElementById('course-selection');
        lessonListView = document.getElementById('lesson-list-view');
        videoPlayerView = document.getElementById('video-player-view');
        lessonList = document.getElementById('lesson-list');
        kinescopePlayer = document.getElementById('kinescope-player');
        videoThumbnailLarge = document.getElementById('video-thumbnail-large');
        noVideoWarning = document.getElementById('no-video-warning');

        bgMusic = document.getElementById('bg-music');
        clickSound = document.getElementById('click-sound');
        document.getElementById('music-toggle').addEventListener('click', toggleMusic);

        registrationOverlay = document.getElementById('registration-overlay');
        policyInitialView = document.getElementById('policy-initial-view');
        policyFullView = document.getElementById('policy-full-view');
        registrationFormView = document.getElementById('registration-form-view');
        successView = document.getElementById('success-view');
        registrationForm = document.getElementById('registration-form');
        loadingSpinner = document.getElementById('loading-spinner');

        document.getElementById('read-policy-btn').addEventListener('click', showPolicyFullView);
        document.getElementById('agree-and-continue-btn').addEventListener('click', showRegistrationForm);
        document.getElementById('agree-final-btn').addEventListener('click', showRegistrationForm);
        registrationForm.addEventListener('submit', handleRegistrationSubmit);

        setupTelegramWebAppEvents();
        setupCarouselWheelScroll();
    }

    // === 4. –ê–£–î–ò–û ===
    function playClickSound() {
        if (isSoundEnabled && clickSound) {
            clickSound.currentTime = 0;
            clickSound.play().catch(() => {});
        }
    }

    function toggleMusic() {
        const btn = document.getElementById('music-toggle');
        if (isMusicPlaying) {
            bgMusic.pause();
            isMusicPlaying = false;
            btn.textContent = '‚ñ∂Ô∏è';
            btn.title = '–§–æ–Ω–æ–≤–∞—è –º—É–∑—ã–∫–∞';
        } else {
            bgMusic.play().then(() => {
                isMusicPlaying = true;
                btn.textContent = '‚è∏Ô∏è';
                btn.title = '–ü–∞—É–∑–∞';
            }).catch(() => {
                isMusicPlaying = false;
                btn.textContent = '‚ñ∂Ô∏è';
            });
        }
    }

    function pauseMusicForVideo() {
        if (isMusicPlaying) bgMusic.pause();
    }

    function resumeMusicAfterVideo() {
        if (isMusicPlaying) {
            bgMusic.play().catch(() => {});
        }
    }

    function setupTelegramWebAppEvents() {
        if (window.Telegram && window.Telegram.WebApp) {
            Telegram.WebApp.ready();
            document.addEventListener('visibilitychange', () => {
                if (document.hidden) {
                    if (isMusicPlaying) bgMusic.pause();
                } else {
                    if (isMusicPlaying) resumeMusicAfterVideo();
                }
            });
        }
    }

    // === 5. –ö–ê–†–£–°–ï–õ–¨: –∫–æ–ª–µ—Å–æ –º—ã—à–∏ -> –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π —Å–∫—Ä–æ–ª–ª ===
    function setupCarouselWheelScroll() {
        const wrapper = document.getElementById('course-carousel-wrapper');
        if (!wrapper) return;
        wrapper.addEventListener('wheel', (e) => {
            if (Math.abs(e.deltaY) > Math.abs(e.deltaX)) {
                e.preventDefault();
                wrapper.scrollLeft += e.deltaY;
            }
        }, { passive: false });
    }

    // === 6. –ù–ê–í–ò–ì–ê–¶–ò–Ø ===
    function startApp() {
        document.body.addEventListener('click', () => {
            if (!isMusicPlaying && bgMusic.paused) toggleMusic();
        }, { once: true });

        handleInitialCheck();
        showCourseSelection();
    }

    function showCourseSelection() {
        courseSelectionPage.classList.remove('hidden');
        lessonListView.classList.add('hidden');
        videoPlayerView.classList.add('hidden');
    }

    function showLessonList(courseId) {
        playClickSound();
        currentCourseId = courseId;

        const course = courses[courseId];
        if (!course) return;

        const placeholderCourseName = document.getElementById('placeholder-course-name');
        document.getElementById('lesson-list-title').textContent = `–ù–∞–±–æ—Ä: ${course.title}`;
        if (placeholderCourseName) placeholderCourseName.textContent = course.title;

        const lessonsPlaceholder = document.getElementById('lessons-placeholder');
        lessonList.innerHTML = '';

        if (!course.lessons.length) {
            lessonsPlaceholder.innerHTML = `
                <span class="placeholder-icon">‚è≥</span>
                <p style="font-size:1.0em;font-weight:700;margin-bottom:4px;">
                    –í–∏–¥–µ–æ-—É—Ä–æ–∫–∏ –¥–ª—è –Ω–∞–±–æ—Ä–∞ "${course.title}" –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –∑–∞–≥—Ä—É–∑–∫–∏.
                </p>
                <p style="font-size:0.9em;">–°–∫–æ—Ä–æ –∑–¥–µ—Å—å –ø–æ—è–≤—è—Ç—Å—è —Ä–æ–ª–∏–∫–∏.</p>
            `;
        } else {
            lessonsPlaceholder.innerHTML = `
                <span class="placeholder-icon">üé¨</span>
                <p style="font-size:1.0em;font-weight:700;margin-bottom:4px;">
                    –í—ã–±–µ—Ä–∏—Ç–µ —É—Ä–æ–∫ –Ω–∏–∂–µ, —á—Ç–æ–±—ã –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤–∏–¥–µ–æ.
                </p>
            `;
        }

        const indexOffset = (typeof course.indexOffset === 'number') ? course.indexOffset : 1;

        course.lessons.forEach((lesson, index) => {
            const displayIndex = index + indexOffset;
            const li = document.createElement('li');
            li.className = 'lesson-item';
            li.innerHTML = `
                <img src="${lesson.imageUrl}" alt="–£—Ä–æ–∫ ${displayIndex}" class="lesson-item-preview">
                <span class="title">${displayIndex}. ${lesson.name}</span>
            `;
            li.addEventListener('click', () => playLesson(lesson, li));
            lessonList.appendChild(li);
        });

        courseSelectionPage.classList.add('hidden');
        videoPlayerView.classList.add('hidden');
        lessonListView.classList.remove('hidden');
        lessonListView.scrollIntoView({ behavior: 'smooth' });
    }

    function playLesson(lesson, clickedElement) {
        playClickSound();
        pauseMusicForVideo();

        document.querySelectorAll('.lesson-item').forEach(item => item.classList.remove('active'));
        clickedElement.classList.add('active');

        document.getElementById('current-lesson-name').textContent = lesson.name;
        videoThumbnailLarge.src = lesson.imageUrl || '';
        videoThumbnailLarge.style.opacity = 1;

        if (lesson.videoId && lesson.videoId.trim() !== '') {
            kinescopePlayer.src = `https://kinescope.io/embed/${lesson.videoId}`;
            noVideoWarning.classList.add('hidden');
            setTimeout(() => { videoThumbnailLarge.style.opacity = 0; }, 150);
        } else {
            kinescopePlayer.src = '';
            noVideoWarning.classList.remove('hidden');
            videoThumbnailLarge.style.opacity = 1;
        }

        lessonListView.classList.add('hidden');
        videoPlayerView.classList.remove('hidden');
        videoPlayerView.scrollIntoView({ behavior: 'smooth' });
    }

    function goBackToLessonList() {
        playClickSound();
        kinescopePlayer.src = '';
        videoThumbnailLarge.style.opacity = 0;
        noVideoWarning.classList.add('hidden');
        resumeMusicAfterVideo();

        if (currentCourseId) {
            videoPlayerView.classList.add('hidden');
            lessonListView.classList.remove('hidden');
            lessonListView.scrollIntoView({ behavior: 'smooth' });
        } else {
            showCourseSelection();
        }
    }

    // === 7. –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø ===
    function getTelegramIdFromContext() {
        if (window.Telegram && window.Telegram.WebApp &&
            Telegram.WebApp.initDataUnsafe &&
            Telegram.WebApp.initDataUnsafe.user) {
            return Telegram.WebApp.initDataUnsafe.user.id.toString();
        }
        const urlParams = new URLSearchParams(window.location.search);
        const tgIdFromUrl = urlParams.get('tg_id');
        return tgIdFromUrl || localStorage.getItem(TG_ID_STORAGE_KEY) || 'null';
    }

    function handleInitialCheck() {
        const registered = localStorage.getItem(USER_STORAGE_KEY);
        const tgId = getTelegramIdFromContext();

        if (registered === 'true') {
            hideRegistrationModal();
        } else {
            if (tgId && tgId !== 'null' && tgId !== 'undefined') {
                const tgInput = document.getElementById('reg-tg-id');
                if (tgInput) tgInput.value = tgId;
                showRegistrationModal(true);
            } else {
                showRegistrationModal(false);
            }
        }
    }

    function showRegistrationModal(skipPolicy = false) {
        registrationOverlay.classList.remove('hidden');
        loadingSpinner.classList.add('hidden');
        [policyFullView, registrationFormView, successView].forEach(v => v.classList.add('hidden'));

        if (skipPolicy) {
            showRegistrationForm();
        } else {
            policyInitialView.classList.remove('hidden');
            document.getElementById('modal-title').textContent = '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!';
        }
    }

    function hideRegistrationModal() {
        registrationOverlay.classList.add('hidden');
    }

    function showPolicyFullView() {
        playClickSound();
        policyInitialView.classList.add('hidden');
        policyFullView.classList.remove('hidden');
        document.getElementById('modal-title').textContent = '–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏';
    }

    function showRegistrationForm() {
        playClickSound();
        policyInitialView.classList.add('hidden');
        policyFullView.classList.add('hidden');
        registrationFormView.classList.remove('hidden');
        document.getElementById('modal-title').textContent = '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è';

        const tgId = getTelegramIdFromContext();
        if (tgId && tgId !== 'null' && tgId !== 'undefined') {
            const tgInput = document.getElementById('reg-tg-id');
            if (tgInput) tgInput.value = tgId;
        }
    }

    function showSuccessView() {
        [policyInitialView, policyFullView, registrationFormView, loadingSpinner].forEach(v => v.classList.add('hidden'));
        successView.classList.remove('hidden');
        document.getElementById('modal-title').textContent = '–ì–æ—Ç–æ–≤–æ!';
    }

    function showLoadingSpinner() {
        [policyInitialView, policyFullView, registrationFormView, successView].forEach(v => v.classList.add('hidden'));
        loadingSpinner.classList.remove('hidden');
        document.getElementById('modal-title').textContent = '–ó–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö...';
    }

    async function handleRegistrationSubmit(e) {
        e.preventDefault();
        playClickSound();
        showLoadingSpinner();

        const formData = new FormData(registrationForm);
        const data = Object.fromEntries(formData.entries());

        if (data.tg_id && data.tg_id !== 'null' && data.tg_id !== 'undefined') {
            data.source = '–¢–µ–ª–µ–≥—Ä–∞–º';
        } else {
            data.source = '–°–∞–π—Ç';
        }

        try {
            await fetch(WEB_APP_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });

            localStorage.setItem(USER_STORAGE_KEY, 'true');
            if (data.source === '–¢–µ–ª–µ–≥—Ä–∞–º') {
                localStorage.setItem(TG_ID_STORAGE_KEY, data.tg_id);
            }

            showSuccessView();
        } catch (err) {
            document.getElementById('modal-title').textContent = '–û—à–∏–±–∫–∞!';
            loadingSpinner.textContent = '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ.';
            setTimeout(() => showRegistrationModal(data.source === '–¢–µ–ª–µ–≥—Ä–∞–º'), 3000);
        }
    }

    // === 8. –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ===
    document.addEventListener('DOMContentLoaded', () => {
        initializeDOMElements();

        document.querySelectorAll('.course-card').forEach(card => {
            card.addEventListener('click', (e) => {
                const courseId = e.currentTarget.getAttribute('data-id');
                showLessonList(courseId);
            });
        });

        startApp();
    });
</script>
</body>
</html>
