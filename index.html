<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–µ–ª–æ –≤ –®–ª—è–ø–µ üéì | –®–∫–æ–ª–∞ –ò–ª–ª—é–∑–∏–π</title>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Permanent+Marker&family=Nunito:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <style>
        :root {
            --primary-color: #333333;
            --secondary-color: #FFFFFF;
            --accent-color: #E67E22;
            --bg-light: #FFF0B5;
            --card-shadow: 0 5px 0px 5px rgba(51, 51, 51, 0.7);
            --text-stroke-color: #FFFFFF;
            --border-thick: 3px solid var(--primary-color);
            --gold-color: #FFD700;
        }

        @keyframes slideIn {
            0% { transform: translateX(100%); opacity: 0; }
            100% { transform: translateX(0); opacity: 1; }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); opacity: 0.8; }
            100% { transform: scale(1); }
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--bg-light);
            color: var(--primary-color);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            border: 8px solid var(--primary-color);
        }

        /* --- –ê–£–î–ò–û --- */
        #audio-controls {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 100;
            display: flex;
            gap: 10px;
        }
        .control-button {
            background-color: var(--secondary-color);
            border: var(--border-thick);
            border-radius: 50%;
            width: 45px;
            height: 45px;
            cursor: pointer;
            font-size: 1.4em;
            line-height: 43px;
            text-align: center;
            box-shadow: 2px 2px 0 var(--primary-color);
            transition: transform 0.1s;
        }
        .control-button:active {
            transform: translate(2px, 2px);
            box-shadow: none;
        }

        /* --- –®–ê–ü–ö–ê --- */
        header {
            background-color: var(--primary-color);
            color: var(--bg-light);
            padding: 15px 0;
            text-align: center;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.3);
            font-family: 'Permanent Marker', cursive;
            border-bottom: 3px solid var(--accent-color);
        }
        header h1 {
            font-size: 2.8em;
            text-shadow: 3px 3px 0 var(--accent-color),
                         6px 6px 0 rgba(0, 0, 0, 0.15);
            line-height: 0.9;
            padding: 5px;
        }

        main {
            padding: 25px 0;
            flex-grow: 1;
            max-width: 800px;
            width: 100%;
            margin: 0 auto;
            display: flex;
            align-items: center; /* –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏ */
        }

        /* --- –í–´–ë–û–† –ö–£–†–°–ê (–ö–ê–†–£–°–ï–õ–¨) --- */
        #course-selection {
            text-align: center;
            padding: 0 10px;
            width: 100%;
        }
        #course-selection h2 {
            font-family: 'Bebas Neue', sans-serif;
            color: var(--primary-color);
            font-size: 2.4em;
            margin-bottom: 20px;
            text-transform: uppercase;
            -webkit-text-stroke: 1px var(--text-stroke-color);
            text-stroke: 1px var(--text-stroke-color);
            border-bottom: 2px dashed var(--primary-color);
            padding-bottom: 8px;
            max-width: 760px;
            margin: 0 auto 20px auto;
        }

        .carousel-wrapper {
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            padding: 10px 0;
            margin-bottom: 10px;
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .carousel-wrapper::-webkit-scrollbar { display: none; }

        .course-carousel {
            display: flex;
            gap: 20px;
            padding: 0 10px;
            width: max-content;
        }

        .course-card {
            background-color: var(--secondary-color);
            border-radius: 12px;
            padding: 15px;
            min-width: 200px;
            max-width: 220px;
            height: 320px; /* –ß—É—Ç—å —É–≤–µ–ª–∏—á–∏–ª –≤—ã—Å–æ—Ç—É –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö –æ–ø–∏—Å–∞–Ω–∏–π */
            box-shadow: 5px 5px 0 var(--primary-color);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 3px solid var(--primary-color);
            scroll-snap-align: center;

            display: flex;
            flex-direction: column;
            justify-content: space-between;
            flex-shrink: 0;
            position: relative; /* –î–ª—è –º–µ—Ç–∫–∏ */

            animation: slideIn 0.5s ease-out forwards;
        }

        /* –ó–∞–¥–µ—Ä–∂–∫–∞ –∞–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è –∫—Ä–∞—Å–æ—Ç—ã */
        .course-card:nth-child(1) { animation-delay: 0s; }
        .course-card:nth-child(2) { animation-delay: 0.1s; }
        .course-card:nth-child(3) { animation-delay: 0.2s; }
        .course-card:nth-child(4) { animation-delay: 0.3s; }
        .course-card:nth-child(5) { animation-delay: 0.4s; }
        .course-card:nth-child(6) { animation-delay: 0.5s; }
        .course-card:nth-child(7) { animation-delay: 0.6s; }
        .course-card:nth-child(8) { animation-delay: 0.7s; }
        .course-card:nth-child(9) { animation-delay: 0.8s; }
        .course-card:nth-child(10) { animation-delay: 0.9s; }

        .course-card:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 8px 8px 0 var(--accent-color);
        }

        .course-card[data-type="big"] {
            border-color: var(--gold-color);
            box-shadow: 5px 5px 0 var(--gold-color);
        }
        
        /* –ú–µ—Ç–∫–∞ "NEW" */
        .badge-new {
            position: absolute;
            top: -10px;
            right: -10px;
            background-color: #e74c3c;
            color: white;
            font-family: 'Bebas Neue', sans-serif;
            padding: 4px 8px;
            border-radius: 4px;
            border: 2px solid var(--primary-color);
            transform: rotate(15deg);
            z-index: 10;
            box-shadow: 2px 2px 0 rgba(0,0,0,0.3);
        }

        .course-card h3 {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.4em;
            color: var(--primary-color);
            text-transform: uppercase;
            margin-bottom: 5px;
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 4px;
        }

        .course-card p {
            color: #555;
            font-style: italic;
            font-size: 0.9em;
            margin-top: 8px;
        }

        .card-image {
            width: 100%;
            height: 120px;
            object-fit: cover;
            border-radius: 6px;
            border: 2px solid var(--primary-color);
            margin-bottom: 10px;
        }
        
        .action-hint {
            font-weight: bold;
            color: var(--accent-color);
            font-size: 0.85em;
            margin-top: auto;
            text-transform: uppercase;
        }

        .hidden { display: none !important; }

        /* --- –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø --- */
        .registration-overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 200;
        }

        .registration-modal {
            background-color: #fff;
            padding: 24px;
            border-radius: 15px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-content-container p {
            margin-bottom: 10px;
            font-size: 0.9em;
            color: #444;
        }

        .policy-text-container {
            font-size: 0.8em;
            max-height: 300px;
            overflow-y: auto;
            padding: 8px;
            border: 1px solid #ddd;
            margin-bottom: 10px;
        }

        .form-group {
            margin-bottom: 10px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 4px;
            font-size: 0.85em;
            font-weight: 700;
        }

        .form-group input {
            width: 100%;
            padding: 6px 8px;
            border-radius: 6px;
            border: 1px solid #ccc;
            font-size: 0.9em;
        }

        .loading-spinner {
            font-size: 0.9em;
            text-align: center;
            padding: 10px 0;
        }

        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 10px;
        }

        .form-button, .back-button {
            background-color: var(--primary-color);
            color: var(--bg-light);
            border: 3px solid var(--primary-color);
            padding: 8px 18px;
            border-radius: 6px;
            cursor: pointer;
            margin-bottom: 14px;
            font-weight: 700;
            transition: all 0.1s;
            width: 100%;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.1em;
            box-shadow: 3px 3px 0 var(--accent-color);
            text-transform: uppercase;
        }
        .form-button:hover, .back-button:hover {
            background-color: #555;
            box-shadow: 3px 3px 0 var(--bg-light);
        }
        .form-button:active, .back-button:active {
            transform: translate(3px, 3px);
            box-shadow: none;
        }

        @media (min-width: 769px) {
            #swipe-hint { font-size: 0.8em; opacity: 0.8; }
        }
    </style>
</head>
<body>

<div id="audio-controls">
    <audio id="bg-music" src="background_music.mp3" loop preload="auto"></audio>
    <button id="music-toggle" class="control-button" title="–§–æ–Ω–æ–≤–∞—è –º—É–∑—ã–∫–∞">‚ñ∂Ô∏è</button>
    <audio id="click-sound" src="click_sound.mp3" preload="auto"></audio>
</div>

<header>
    <h1>–î–µ–ª–æ –≤ –®–ª—è–ø–µ üéì</h1>
</header>

<main>
    <section id="course-selection">
        <h2>–í—ã–±–µ—Ä–∏—Ç–µ —Å–≤–æ–π –Ω–∞–±–æ—Ä (–Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫)</h2>
        <div class="carousel-wrapper" id="course-carousel-wrapper">
            <div class="course-carousel">
                
                <div class="course-card" data-link="https://disk.yandex.ru/d/7GCK3lh-fGtkrg" data-type="big">
                    <div class="badge-new">NEW</div>
                    <img src="images/set1.png" alt="75 –ª—É—á—à–∏—Ö —Ñ–æ–∫—É—Å–æ–≤ New" class="card-image">
                    <h3>75 –õ–£–ß–®–ò–• (2025-2026)</h3>
                    <p>–ù–æ–≤–µ–π—à–∞—è –≤–µ—Ä—Å–∏—è –Ω–∞–±–æ—Ä–∞. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –∞—Ä—Å–µ–Ω–∞–ª.</p>
                    <span class="action-hint">–û—Ç–∫—Ä—ã—Ç—å –¥–∏—Å–∫ ‚ûî</span>
                </div>

                <div class="course-card" data-link="https://disk.yandex.ru/d/ks6h36c_VHd1rg" data-type="big">
                    <img src="images/set1.png" alt="75 –ª—É—á—à–∏—Ö —Ñ–æ–∫—É—Å–æ–≤" class="card-image">
                    <h3>75 –õ–£–ß–®–ò–• –§–û–ö–£–°–û–í</h3>
                    <p>–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –ø–æ–ª–Ω–∞—è –≤–µ—Ä—Å–∏—è –∫—É—Ä—Å–∞.</p>
                    <span class="action-hint">–û—Ç–∫—Ä—ã—Ç—å –¥–∏—Å–∫ ‚ûî</span>
                </div>

                <div class="course-card" data-link="https://disk.yandex.ru/d/WjI7o6WA7RGRQw" data-type="big">
                    <img src="images/set_new_50.png" alt="50 –ª—É—á—à–∏—Ö —Ñ–æ–∫—É—Å–æ–≤" class="card-image">
                    <h3>50 –õ–£–ß–®–ò–• –§–û–ö–£–°–û–í</h3>
                    <p>–°–∏–ª—å–Ω–∞—è –±–∞–∑–∞ –∏ —Ç–æ–ø–æ–≤—ã–µ —Ç—Ä—é–∫–∏. –í—Å—Ç—É–ø–ª–µ–Ω–∏–µ ‚Äî –Ω–æ–º–µ—Ä 0.</p>
                    <span class="action-hint">–û—Ç–∫—Ä—ã—Ç—å –¥–∏—Å–∫ ‚ûî</span>
                </div>

                <div class="course-card" data-link="https://disk.yandex.ru/d/0VVD1y_ZakwGpQ" data-type="big">
                    <div class="badge-new">NEW</div>
                    <img src="images/set_new_35.png" alt="35 –ª—É—á—à–∏—Ö —Ñ–æ–∫—É—Å–æ–≤ New" class="card-image">
                    <h3>35 –õ–£–ß–®–ò–• (2025-2026)</h3>
                    <p>–ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è. –§—É—Ç–ª—è—Ä—ã, –ª–∞–º–ø—ã, –º–∞—Ä–∫–µ—Ä—ã.</p>
                    <span class="action-hint">–û—Ç–∫—Ä—ã—Ç—å –¥–∏—Å–∫ ‚ûî</span>
                </div>

                 <div class="course-card" data-link="https://disk.yandex.ru/d/Hc1yBffG4BOE5Q" data-type="big">
                    <img src="images/set_new_35.png" alt="35 –ª—É—á—à–∏—Ö —Ñ–æ–∫—É—Å–æ–≤" class="card-image">
                    <h3>35 –õ–£–ß–®–ò–• –§–û–ö–£–°–û–í</h3>
                    <p>–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –ª–∏–Ω–µ–π–∫–∞ —Ñ–æ–∫—É—Å–æ–≤ 25+10.</p>
                    <span class="action-hint">–û—Ç–∫—Ä—ã—Ç—å –¥–∏—Å–∫ ‚ûî</span>
                </div>

                <div class="course-card" data-link="https://disk.yandex.ru/d/AvjMx4kI9k0KDw" data-type="small">
                    <img src="images/set_green.png" alt="10 –≤–∑—Ä—ã–≤–Ω—ã—Ö —Ñ–æ–∫—É—Å–æ–≤ (–∑–µ–ª—ë–Ω—ã–π)" class="card-image">
                    <h3>10 –í–ó–†–´–í–ù–´–• (–ó–ï–õ–Å–ù–´–ô)</h3>
                    <p>–ö—É–ø—é—Ä—ã, —Ä–µ–∑–∏–Ω–∫–∏ –∏ –ø–∞–∫–µ—Ç—ã: —Å–∏–ª—å–Ω—ã–µ –∫–∞—Ä–º–∞–Ω–Ω—ã–µ —Ç—Ä—é–∫–∏.</p>
                    <span class="action-hint">–û—Ç–∫—Ä—ã—Ç—å –¥–∏—Å–∫ ‚ûî</span>
                </div>

                <div class="course-card" data-link="https://disk.yandex.ru/d/aJc0aCWHA4CiQw" data-type="small">
                    <img src="images/set_blue.png" alt="10 –≤–∑—Ä—ã–≤–Ω—ã—Ö —Ñ–æ–∫—É—Å–æ–≤ (—Å–∏–Ω–∏–π)" class="card-image">
                    <h3>10 –í–ó–†–´–í–ù–´–• (–°–ò–ù–ò–ô)</h3>
                    <p>–ü–µ—á–µ–Ω—å–µ, —Ç—Ä–æ—Å—Ç—å, —Å—Ç–∞–∫–∞–Ω—ã –∏ –∑—Ä–µ–ª–∏—â–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã.</p>
                    <span class="action-hint">–û—Ç–∫—Ä—ã—Ç—å –¥–∏—Å–∫ ‚ûî</span>
                </div>

                <div class="course-card" data-link="https://disk.yandex.ru/d/3OTNh2-HgbyW1A" data-type="small">
                    <img src="images/set_purple.png" alt="10 –í–§ –î–≤–® (—Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π)" class="card-image">
                    <h3>10 –í–§ (–§–ò–û–õ–ï–¢–û–í–´–ô)</h3>
                    <p>–ö—É–ø—é—Ä—ã, –∫–∞—Ä—Ç—ã –∏ –ø–ª–∞—Ç–∫–∏. –í–Ω–∏–º–∞–Ω–∏–µ –∫ –¥–µ—Ç–∞–ª—è–º.</p>
                    <span class="action-hint">–û—Ç–∫—Ä—ã—Ç—å –¥–∏—Å–∫ ‚ûî</span>
                </div>

                <div class="course-card" data-link="https://disk.yandex.ru/d/gFE5pkX7C9um5Q" data-type="small">
                    <img src="images/set_orange.png" alt="10 –í–§ –î–≤–® (–æ—Ä–∞–Ω–∂–µ–≤—ã–π)" class="card-image">
                    <h3>10 –í–§ (–û–†–ê–ù–ñ–ï–í–´–ô)</h3>
                    <p>–û—Ç –ø–æ—Ä–æ–ª–æ–Ω–æ–≤—ã—Ö —à–∞—Ä–∏–∫–æ–≤ –¥–æ —Ä–µ–∑–∏–Ω–æ–∫.</p>
                    <span class="action-hint">–û—Ç–∫—Ä—ã—Ç—å –¥–∏—Å–∫ ‚ûî</span>
                </div>

                <div class="course-card" data-link="https://disk.yandex.ru/d/g8kHv3nGNcUz9A" data-type="small">
                    <img src="images/set5.png" alt="5 –ª—É—á—à–∏—Ö —Ñ–æ–∫—É—Å–æ–≤" class="card-image">
                    <h3>5 –õ–£–ß–®–ò–• –§–û–ö–£–°–û–í</h3>
                    <p>–°–∏–ª—å–Ω–µ–π—à–∏–µ —Ç—Ä—é–∫–∏ + –±–æ–Ω—É—Å—ã.</p>
                    <span class="action-hint">–û—Ç–∫—Ä—ã—Ç—å –¥–∏—Å–∫ ‚ûî</span>
                </div>

            </div>
        </div>
        <p id="swipe-hint" style="text-align: center; color: var(--primary-color); font-weight: 700; margin-top: 4px;">
            –ù–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ ‚Äî —Å–≤–∞–π–ø–Ω–∏—Ç–µ –ø–æ –∫–∞—Ä—Ç–æ—á–∫–∞–º. –ù–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä–µ ‚Äî –ø—Ä–æ–∫—Ä—É—Ç–∏—Ç–µ –∫–æ–ª–µ—Å–æ –º—ã—à–∏ –≤–±–æ–∫.
        </p>
    </section>
</main>

<div id="registration-overlay" class="registration-overlay hidden">
    <div class="registration-modal">
        <h2 id="modal-title">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h2>
        <div id="modal-content-container" class="modal-content-container">

            <div id="policy-initial-view">
                <p>–î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –æ–±—É—á–µ–Ω–∏—é –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–≥–ª–∞—Å–∏—Ç—å—Å—è —Å –ü–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏.</p>
                <div class="action-buttons">
                    <button id="read-policy-btn" class="form-button">–ü—Ä–æ—á–∏—Ç–∞—Ç—å –ü–æ–ª–∏—Ç–∏–∫—É</button>
                    <button id="agree-and-continue-btn" class="form-button">–°–æ–≥–ª–∞—Å–∏—Ç—å—Å—è –∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
                </div>
            </div>

            <div id="policy-full-view" class="hidden">
                <p><b>–î–∞—Ç–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –¥–µ–π—Å—Ç–≤—É—é—â–µ–π —Ä–µ–¥–∞–∫—Ü–∏–∏: 1 —Å–µ–Ω—Ç—è–±—Ä—è 2025 –≥–æ–¥–∞</b></p>
                <div class="policy-text-container">
                    <p>1. –û–±—â–∏–µ –ø–æ–ª–æ–∂–µ–Ω–∏—è, —Å—Ç–æ—Ä–æ–Ω—ã, —Ü–µ–ª—å –¥–æ–∫—É–º–µ–Ω—Ç–∞...</p>
                </div>
                <button id="agree-final-btn" class="form-button">–°–æ–≥–ª–∞—Å–∏—Ç—å—Å—è —Å –ü–æ–ª–∏—Ç–∏–∫–æ–π</button>
            </div>

            <div id="registration-form-view" class="hidden">
                <form id="registration-form">
                    <div class="form-group">
                        <label for="reg-name">–§–∞–º–∏–ª–∏—è –∏ –ò–º—è:</label>
                        <input type="text" id="reg-name" name="name" required placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω">
                    </div>
                    <div class="form-group">
                        <label for="reg-age">–í–æ–∑—Ä–∞—Å—Ç:</label>
                        <input type="number" id="reg-age" name="age" min="1" max="120" required>
                    </div>
                    <div class="form-group">
                        <label for="reg-phone">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞:</label>
                        <input type="tel" id="reg-phone" name="phone" pattern="\+?[0-9]{10,15}" required placeholder="+79123456789">
                    </div>
                    <div class="form-group hidden">
                        <label for="reg-tg-id">Telegram ID (–°–∫—Ä—ã—Ç–æ):</label>
                        <input type="text" id="reg-tg-id" name="tg_id">
                    </div>
                    <button type="submit" id="submit-reg-btn" class="form-button">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –∏ –Ω–∞—á–∞—Ç—å</button>
                </form>
            </div>

            <div id="success-view" class="hidden" style="text-align: center;">
                <h3 style="color: green;">üéâ –£—Å–ø–µ—à–Ω–æ!</h3>
                <p>–í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã. –í—ã –º–æ–∂–µ—Ç–µ –ø—Ä–∏—Å—Ç—É–ø–∏—Ç—å –∫ –æ–±—É—á–µ–Ω–∏—é.</p>
                <button onclick="hideRegistrationModal()" class="back-button">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
            </div>

            <div id="loading-spinner" class="loading-spinner hidden">
                –ó–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö... üöÄ –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ...
            </div>

        </div>
    </div>
</div>

<script>
    // === 0. –ö–û–ù–°–¢–ê–ù–¢–´ ===
    const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycby2R4j1aBQ2zmybXyqjVhgFntoduCYYX6AuZ8kMmRUWdF8ZQCNTTpPij0kmxaSxAZmjvg/exec';
    const USER_STORAGE_KEY = 'magic_course_user_registered_hat';
    const TG_ID_STORAGE_KEY = 'magic_course_tg_id_hat';

    // === 1. –ì–õ–û–ë–ê–õ ===
    let bgMusic, clickSound, isMusicPlaying = false, isSoundEnabled = true;
    let registrationOverlay, policyInitialView, policyFullView, registrationFormView, successView;
    let registrationForm, loadingSpinner;

    function initializeDOMElements() {
        bgMusic = document.getElementById('bg-music');
        clickSound = document.getElementById('click-sound');
        document.getElementById('music-toggle').addEventListener('click', toggleMusic);

        registrationOverlay = document.getElementById('registration-overlay');
        policyInitialView = document.getElementById('policy-initial-view');
        policyFullView = document.getElementById('policy-full-view');
        registrationFormView = document.getElementById('registration-form-view');
        successView = document.getElementById('success-view');
        registrationForm = document.getElementById('registration-form');
        loadingSpinner = document.getElementById('loading-spinner');

        document.getElementById('read-policy-btn').addEventListener('click', showPolicyFullView);
        document.getElementById('agree-and-continue-btn').addEventListener('click', showRegistrationForm);
        document.getElementById('agree-final-btn').addEventListener('click', showRegistrationForm);
        registrationForm.addEventListener('submit', handleRegistrationSubmit);

        setupTelegramWebAppEvents();
        setupCarouselWheelScroll();
    }

    // === 2. –ê–£–î–ò–û ===
    function playClickSound() {
        if (isSoundEnabled && clickSound) {
            clickSound.currentTime = 0;
            clickSound.play().catch(() => {});
        }
    }

    function toggleMusic() {
        const btn = document.getElementById('music-toggle');
        if (isMusicPlaying) {
            bgMusic.pause();
            isMusicPlaying = false;
            btn.textContent = '‚ñ∂Ô∏è';
            btn.title = '–§–æ–Ω–æ–≤–∞—è –º—É–∑—ã–∫–∞';
        } else {
            bgMusic.play().then(() => {
                isMusicPlaying = true;
                btn.textContent = '‚è∏Ô∏è';
                btn.title = '–ü–∞—É–∑–∞';
            }).catch(() => {
                isMusicPlaying = false;
                btn.textContent = '‚ñ∂Ô∏è';
            });
        }
    }

    function setupTelegramWebAppEvents() {
        if (window.Telegram && window.Telegram.WebApp) {
            Telegram.WebApp.ready();
            document.addEventListener('visibilitychange', () => {
                if (document.hidden) {
                    if (isMusicPlaying) bgMusic.pause();
                } else {
                    if (isMusicPlaying) bgMusic.play().catch(() => {});
                }
            });
        }
    }

    // === 3. –ö–ê–†–£–°–ï–õ–¨ ===
    function setupCarouselWheelScroll() {
        const wrapper = document.getElementById('course-carousel-wrapper');
        if (!wrapper) return;
        wrapper.addEventListener('wheel', (e) => {
            if (Math.abs(e.deltaY) > Math.abs(e.deltaX)) {
                e.preventDefault();
                wrapper.scrollLeft += e.deltaY;
            }
        }, { passive: false });
    }

    // === 4. –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø ===
    function getTelegramIdFromContext() {
        if (window.Telegram && window.Telegram.WebApp &&
            Telegram.WebApp.initDataUnsafe &&
            Telegram.WebApp.initDataUnsafe.user) {
            return Telegram.WebApp.initDataUnsafe.user.id.toString();
        }
        const urlParams = new URLSearchParams(window.location.search);
        const tgIdFromUrl = urlParams.get('tg_id');
        return tgIdFromUrl || localStorage.getItem(TG_ID_STORAGE_KEY) || 'null';
    }

    function handleInitialCheck() {
        const registered = localStorage.getItem(USER_STORAGE_KEY);
        const tgId = getTelegramIdFromContext();

        if (registered === 'true') {
            hideRegistrationModal();
        } else {
            if (tgId && tgId !== 'null' && tgId !== 'undefined') {
                const tgInput = document.getElementById('reg-tg-id');
                if (tgInput) tgInput.value = tgId;
                showRegistrationModal(true);
            } else {
                showRegistrationModal(false);
            }
        }
    }

    function showRegistrationModal(skipPolicy = false) {
        registrationOverlay.classList.remove('hidden');
        loadingSpinner.classList.add('hidden');
        [policyFullView, registrationFormView, successView].forEach(v => v.classList.add('hidden'));

        if (skipPolicy) {
            showRegistrationForm();
        } else {
            policyInitialView.classList.remove('hidden');
            document.getElementById('modal-title').textContent = '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!';
        }
    }

    function hideRegistrationModal() {
        registrationOverlay.classList.add('hidden');
    }

    function showPolicyFullView() {
        playClickSound();
        policyInitialView.classList.add('hidden');
        policyFullView.classList.remove('hidden');
        document.getElementById('modal-title').textContent = '–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏';
    }

    function showRegistrationForm() {
        playClickSound();
        policyInitialView.classList.add('hidden');
        policyFullView.classList.add('hidden');
        registrationFormView.classList.remove('hidden');
        document.getElementById('modal-title').textContent = '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è';

        const tgId = getTelegramIdFromContext();
        if (tgId && tgId !== 'null' && tgId !== 'undefined') {
            const tgInput = document.getElementById('reg-tg-id');
            if (tgInput) tgInput.value = tgId;
        }
    }

    function showSuccessView() {
        [policyInitialView, policyFullView, registrationFormView, loadingSpinner].forEach(v => v.classList.add('hidden'));
        successView.classList.remove('hidden');
        document.getElementById('modal-title').textContent = '–ì–æ—Ç–æ–≤–æ!';
    }

    function showLoadingSpinner() {
        [policyInitialView, policyFullView, registrationFormView, successView].forEach(v => v.classList.add('hidden'));
        loadingSpinner.classList.remove('hidden');
        document.getElementById('modal-title').textContent = '–ó–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö...';
    }

    async function handleRegistrationSubmit(e) {
        e.preventDefault();
        playClickSound();
        showLoadingSpinner();

        const formData = new FormData(registrationForm);
        const data = Object.fromEntries(formData.entries());

        if (data.tg_id && data.tg_id !== 'null' && data.tg_id !== 'undefined') {
            data.source = '–¢–µ–ª–µ–≥—Ä–∞–º –†—É—Å–ª–∞–Ω';
        } else {
            data.source = '–°–∞–π—Ç –†—É—Å–ª–∞–Ω';
        }

        try {
            await fetch(WEB_APP_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });

            localStorage.setItem(USER_STORAGE_KEY, 'true');
            if (data.source === '–¢–µ–ª–µ–≥—Ä–∞–º –†—É—Å–ª–∞–Ω') {
                localStorage.setItem(TG_ID_STORAGE_KEY, data.tg_id);
            }

            showSuccessView();
        } catch (err) {
            document.getElementById('modal-title').textContent = '–û—à–∏–±–∫–∞!';
            loadingSpinner.textContent = '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ.';
            setTimeout(() => showRegistrationModal(data.source === '–¢–µ–ª–µ–≥—Ä–∞–º –†—É—Å–ª–∞–Ω'), 3000);
        }
    }

    // === 5. –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ===
    document.addEventListener('DOMContentLoaded', () => {
        initializeDOMElements();

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–ª–∏–∫–∞ –ø–æ –∫–∞—Ä—Ç–æ—á–∫–∞–º —Å –ø—Ä—è–º–æ–π —Å—Å—ã–ª–∫–æ–π
        document.querySelectorAll('.course-card').forEach(card => {
            card.addEventListener('click', (e) => {
                const link = e.currentTarget.getAttribute('data-link');
                if (link) {
                    playClickSound();
                    // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞, —á—Ç–æ–±—ã –∑–≤—É–∫ —É—Å–ø–µ–ª –Ω–∞—á–∞—Ç—å –ø—Ä–æ–∏–≥—Ä—ã–≤–∞–Ω–∏–µ
                    setTimeout(() => {
                        window.open(link, '_blank');
                    }, 100);
                }
            });
        });

        // –ó–∞–ø—É—Å–∫ –º—É–∑—ã–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∫–ª–∏–∫–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ (–ø–æ–ª–∏—Ç–∏–∫–∞ –±—Ä–∞—É–∑–µ—Ä–æ–≤)
        document.body.addEventListener('click', () => {
            if (!isMusicPlaying && bgMusic.paused) toggleMusic();
        }, { once: true });

        handleInitialCheck();
    });
</script>
</body>
</html>
